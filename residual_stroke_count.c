#include "commands.h"
#include "radicals.h"
#include "residual_stroke_count.h"
#include "streams.h"
#include "util.h"

static const uint8_t counts[] = {
0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0c,
0x00,0x01,0x02,0x04,0x05,0x06,
0x00,0x01,0x02,0x04,0x05,0x06,0x07,0x08,0x0b,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x13,0x14,
0x00,0x02,0x03,0x04,0x05,0x06,0x08,0x09,0x0b,
0x00,0x02,0x04,0x06,
0x00,0x02,0x04,0x05,0x06,0x08,
0x00,0x02,0x03,0x04,0x06,0x07,
0x00,0x02,0x03,0x06,0x07,0x08,0x09,
0x00,0x03,0x04,0x05,0x06,0x08,0x0d,0x0e,
0x00,0x01,0x03,0x04,0x06,0x09,0x0a,
0x00,0x02,0x03,0x06,
0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,
0x00,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0d,0x11,
0x00,0x01,0x02,0x03,0x04,0x06,0x07,0x09,
0x00,0x02,0x03,0x09,
0x00,0x02,0x03,0x04,0x05,0x06,0x08,0x09,0x0b,0x0c,0x0d,
0x00,0x01,0x02,0x03,0x04,0x06,0x07,0x0a,
0x00,0x03,0x06,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,
0x00,0x02,0x06,0x07,0x08,0x0a,0x0c,
0x00,0x02,0x03,0x06,0x09,
0x00,0x01,0x02,0x06,0x07,0x0e,0x10,
0x00,0x05,0x06,0x08,0x09,0x0e,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x11,0x12,0x13,0x15,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x17,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x10,0x11,0x15,
0x00,0x01,0x03,0x04,0x06,0x08,0x09,0x0a,0x0b,
0x00,0x06,0x07,0x0b,0x12,
0x00,0x02,0x03,0x05,0x08,0x0a,0x0b,
0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x09,0x0a,0x0b,0x0c,0x0d,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x10,0x11,
0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0b,0x0d,0x0e,0x10,0x13,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x10,0x11,
0x00,0x03,0x04,0x06,0x07,0x08,0x09,0x0b,0x0c,
0x00,0x01,0x03,0x05,
0x00,0x01,0x04,0x05,0x09,
0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x09,0x0b,0x0c,0x12,
0x00,0x01,
0x00,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0d,0x0e,0x11,0x12,0x13,0x14,
0x00,0x03,0x04,0x06,
0x00,0x02,0x04,0x07,
0x00,0x01,0x06,0x09,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0e,
0x00,0x02,0x03,0x05,0x0a,
0x00,0x01,0x02,0x06,0x09,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x10,0x11,0x12,0x16,
0x00,0x04,0x05,0x06,
0x00,0x01,0x02,0x04,0x06,0x0c,
0x00,0x01,0x03,
0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0b,0x0c,0x0d,0x0e,0x13,
0x00,0x06,0x08,0x0a,
0x00,0x04,0x06,0x08,0x09,0x0b,0x0c,
0x00,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,
0x00,0x01,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x11,0x12,0x13,0x18,
0x00,0x01,0x02,0x03,0x04,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,
0x00,0x03,0x04,0x05,0x06,0x07,0x08,
0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x11,0x12,0x13,0x14,0x16,
0x00,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,
0x00,0x06,0x08,
0x00,0x06,0x07,0x0a,
0x00,0x01,0x04,0x07,0x08,0x09,0x0b,0x0e,
0x00,0x04,0x05,0x06,0x07,0x0a,0x0e,
0x00,0x05,
0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x11,
0x00,0x02,0x04,0x06,0x07,0x08,0x0b,0x0d,0x10,
0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x11,0x13,0x15,0x16,0x18,
0x00,0x02,0x04,0x06,0x07,0x08,0x0a,0x0b,0x0d,0x11,
0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x09,0x0a,0x0b,0x0c,0x0e,
0x00,0x02,0x05,0x06,0x08,0x0b,0x0e,0x0f,0x11,
0x00,0x04,0x05,0x06,0x07,0x09,0x0b,
0x00,0x02,0x04,
0x00,0x05,
0x00,0x04,0x06,0x07,0x08,0x0a,0x0b,
0x00,0x01,
0x00,0x02,0x06,
0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x11,0x13,0x16,0x17,0x18,0x1c,0x1d,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x11,0x1a,
0x00,0x04,0x05,0x08,0x0b,0x0d,
0x00,0x04,0x06,0x09,
0x00,0x07,0x0a,
0x00,0x04,0x06,0x0a,
0x00,0x04,0x08,0x09,0x0a,0x0b,
0x00,0x08,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x0a,0x0b,0x0d,0x10,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x10,0x13,
0x00,0x04,0x06,
0x00,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0d,0x0e,0x10,0x11,
0x00,0x06,0x0b,
0x00,0x03,0x04,0x06,0x0a,0x0b,0x0d,
0x00,0x04,0x06,
0x00,0x04,0x06,0x07,
0x00,0x02,0x04,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x0a,0x0b,0x0e,0x11,
0x00,0x07,0x09,
0x00,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x10,0x11,0x12,0x13,0x19,
0x00,0x04,0x07,
0x00,0x01,0x03,0x04,0x05,0x06,0x07,0x0b,
0x00,0x03,0x0a,0x0b,
0x00,0x03,0x04,0x05,0x06,0x08,0x09,0x0a,0x0b,0x0c,
0x00,0x03,0x04,0x05,0x06,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0f,0x10,0x13,0x15,
0x00,0x04,
0x00,0x03,0x04,0x05,0x06,0x07,0x08,0x0c,
0x00,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,
0x00,0x01,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0b,0x0c,0x0d,0x0e,0x11,
0x00,0x04,0x06,0x08,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x10,0x11,
0x00,0x02,0x03,0x04,0x05,0x06,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x10,0x11,
0x00,0x05,0x06,0x07,0x09,0x0f,0x11,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x11,0x13,0x1a,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x10,0x13,
0x00,0x01,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x11,0x12,0x16,
0x00,0x03,0x04,0x05,0x06,0x0b,0x10,0x11,
0x00,0x05,0x06,0x08,0x09,0x0a,0x0b,0x0e,0x11,0x13,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x0d,
0x00,0x03,0x04,0x05,0x06,0x08,0x09,0x0a,0x0b,0x0c,0x0e,
0x00,0x02,0x04,0x06,
0x00,0x03,
0x00,0x03,0x04,0x0b,
0x00,0x01,0x03,0x04,0x05,0x06,0x07,0x08,0x0b,0x0c,0x10,
0x00,0x07,0x08,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x12,0x13,
0x00,0x02,0x06,0x0b,
0x00,0x03,0x04,0x06,
0x00,0x04,0x06,0x08,
0x00,0x03,0x04,0x06,0x07,0x09,0x0b,
0x00,0x04,0x06,0x09,0x0a,
0x00,0x06,0x07,0x08,
0x00,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0b,0x0d,0x0f,0x10,
0x00,0x01,0x0b,
0x00,0x05,0x06,0x0d,0x12,
0x00,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x11,0x13,0x16,0x19,0x20,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x0b,
0x00,0x01,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x11,0x12,0x13,
0x00,0x03,0x06,
0x00,0x03,0x05,0x06,0x07,0x09,0x0a,0x12,
0x00,0x02,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0d,0x0e,0x10,0x11,
0x00,0x03,0x06,0x0c,0x0d,0x13,
0x00,0x04,0x05,0x06,0x08,0x09,0x0a,0x0b,0x0d,0x11,
0x00,0x06,0x0b,0x0d,0x10,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x11,0x13,
0x00,0x05,0x06,
0x00,0x06,0x0b,0x15,
0x00,0x04,0x05,0x06,0x07,0x09,0x0b,
0x00,0x03,0x05,0x06,0x07,0x0a,0x0b,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0e,0x0f,0x11,
0x00,0x04,0x06,0x07,
0x00,0x02,0x03,0x05,0x06,0x07,0x08,0x0a,
0x00,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x12,0x13,
0x00,0x03,0x04,0x05,0x06,0x08,0x09,0x0b,0x11,
0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0e,0x0f,0x10,
0x00,0x06,0x07,0x09,
0x00,0x03,0x06,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x13,
0x00,0x04,0x05,0x06,0x07,0x08,0x0a,0x0b,0x0c,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0d,0x11,0x12,
0x00,0x04,0x05,0x0d,
0x00,0x02,0x04,0x05,0x0b,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0f,0x10,0x11,0x12,0x13,0x14,
0x00,0x04,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,
0x00,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x10,
0x00,0x08,
0x00,0x02,0x03,0x04,0x05,0x06,0x08,0x09,0x0a,0x0b,
0x00,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x11,
0x00,0x05,0x06,0x08,
0x00,0x07,0x0b,
0x00,
0x00,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0b,0x0c,
0x00,0x06,0x08,0x0a,
0x00,0x03,
0x00,0x05,0x0a,0x0b,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0e,0x0f,0x10,0x11,0x12,
0x00,0x03,0x05,0x06,0x09,0x0b,
0x00,
0x00,0x02,0x04,0x05,0x06,0x07,0x08,0x0a,0x0b,0x0c,0x0d,0x11,
0x00,
0x00,0x09,0x0b,
0x00,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x10,0x11,0x12,0x13,0x14,0x18,
0x00,0x06,0x09,0x0b,0x0c,0x0d,
0x00,
0x00,0x04,0x05,0x06,0x08,0x0a,0x0b,0x0c,0x0e,
0x00,0x06,0x0b,0x10,
0x00,0x0a,0x13,
0x00,0x06,0x0b,
0x00,0x04,0x05,0x08,0x0b,0x0e,
0x00,0x02,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x10,
0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x11,0x13,
0x00,0x08,0x0e,
0x00,0x02,0x04,0x05,0x06,0x07,0x08,0x0b,0x0c,
0x00,0x04,0x05,0x06,0x08,0x09,0x0b,
0x00,0x03,0x04,0x07,
0x00,
0x00,0x03,0x05,0x0b,
0x00,0x03,0x05,0x06,0x0b,
0x00,
0x00,0x04,0x05,0x06,0x0a,0x0c,0x0d,
0x00,
0x00,0x06,
0x00,0x05,0x06,
0x00,0x0b,
0x00,0x03,0x07,
0x00,0x02,0x05,0x06,0x07,
0x00,0x06,0x11,
0x00,0x04,
0x00,
};

int residual_stroke_count(struct kanji_entry const *k)
{
	return residual_stroke_count_from_rsc_sort_key(k->rsc_sort_key);
}

int residual_stroke_count_from_rsc_sort_key(unsigned rsc_sort_key)
{
	unsigned index = rsc_sort_key - 1;
	if (index >= sizeof(counts))
		DIE(0, "%u >= %zu", index, sizeof(counts));
	return counts[index];
}

int largest_residual_stroke_count(void)
{
	int i;
	int result = -1;

	for (i = 0; i < sizeof(counts); i++)
		if (counts[i] > result)
			result = counts[i];

	return result;
}

int expand_rsc_keys(char **argv, int argc)
{
	int i, radind = -1, kc = 0xfff, kr, ki;
	struct kanji_entry const *ke;

	while (argc--) {
		if (!strcmp(*argv, "-1")) kc = 1; else
		if (!strcmp(*argv, "-0")) kc = 0; else
		DIE(0, "無効な引数: %s", *argv);

		argv++;
	}

	ki = 0;
	for (i = 0; i < sizeof counts; i++) {
		if (!counts[i]) radind++;

		fprintf(out, "%02x%02x", radical_num(radind), counts[i]);
		if (kc) fputc(' ', out);

		kr = kc;
		for (;;) {
			ke = kanji_from_rsc_index(ki);

			if (kr != kc && ke->cutoff_type) break;
			if (kr-- > 0) fputs(ke->c, out);

			if (++ki >= kanji_db_nr()) break;
		}

		fputc('\n', out);
	}

	return 0;
}
